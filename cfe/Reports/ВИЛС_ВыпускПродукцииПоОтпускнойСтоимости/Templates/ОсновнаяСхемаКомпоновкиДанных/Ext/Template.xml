<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Склад</dataPath>
			<field>Склад</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Организация</dataPath>
			<field>Организация</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Регистратор</dataPath>
			<field>Регистратор</field>
			<role>
				<dcscom:periodNumber>1</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Подразделение</dataPath>
			<field>Подразделение</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НаправлениеДеятельности</dataPath>
			<field>НаправлениеДеятельности</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Характеристика</dataPath>
			<field>Характеристика</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Серия</dataPath>
			<field>Серия</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТипЗапасов</dataPath>
			<field>ТипЗапасов</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидЗапасов</dataPath>
			<field>ВидЗапасов</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ХозяйственнаяОперация</dataPath>
			<field>ХозяйственнаяОперация</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>АналитикаУчетаНоменклатуры</dataPath>
			<field>АналитикаУчетаНоменклатуры</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КорНаправлениеДеятельности</dataPath>
			<field>КорНаправлениеДеятельности</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КорАналитикаУчетаНоменклатуры</dataPath>
			<field>КорАналитикаУчетаНоменклатуры</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КорСклад</dataPath>
			<field>КорСклад</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КорТипЗапасов</dataPath>
			<field>КорТипЗапасов</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КорВидЗапасов</dataPath>
			<field>КорВидЗапасов</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказКлиента</dataPath>
			<field>ЗаказКлиента</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КодСтроки</dataPath>
			<field>КодСтроки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Период</dataPath>
			<field>Период</field>
			<role>
				<dcscom:periodNumber>3</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПериодЗаказа</dataPath>
			<field>ПериодЗаказа</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Период заказа</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:periodNumber>2</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Шт</dataPath>
			<field>Шт</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Шт</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧЦ=15; ЧДЦ=3</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Кг</dataPath>
			<field>Кг</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Кг</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧЦ=15; ЧДЦ=3</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Стоимость</dataPath>
			<field>Стоимость</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цеховая себестоимость</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Количество</dataPath>
			<field>Количество</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>М2</dataPath>
			<field>М2</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>М2</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧЦ=15; ЧДЦ=3</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоЗаказано</dataPath>
			<field>КоличествоЗаказано</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество заказано</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаЗаказано</dataPath>
			<field>СуммаЗаказано</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма заказано</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОтпускнаяСтоимость</dataPath>
			<field>ОтпускнаяСтоимость</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Отпускная стоимость</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧЦ=15; ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЦенаПоЗаказу</dataPath>
			<field>ЦенаПоЗаказу</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цена по заказу</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧЦ=15; ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПоЗаказу</dataPath>
			<field>ПоЗаказу</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Только по заказу покупателя</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказДавальца</dataPath>
			<field>ЗаказДавальца</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВалютаКт</dataPath>
			<field>ВалютаКт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоДт2</dataPath>
			<field>СубконтоДт2</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПодразделениеКт</dataPath>
			<field>ПодразделениеКт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СчетДт</dataPath>
			<field>СчетДт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СчетКт</dataPath>
			<field>СчетКт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоДт1</dataPath>
			<field>СубконтоДт1</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоДт3</dataPath>
			<field>СубконтоДт3</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоКт1</dataPath>
			<field>СубконтоКт1</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоКт2</dataPath>
			<field>СубконтоКт2</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СубконтоКт3</dataPath>
			<field>СубконтоКт3</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВалютаДт</dataPath>
			<field>ВалютаДт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПодразделениеДт</dataPath>
			<field>ПодразделениеДт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НаправлениеДеятельностиДт</dataPath>
			<field>НаправлениеДеятельностиДт</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НаправлениеДеятельностиКт</dataPath>
			<field>НаправлениеДеятельностиКт</field>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗЛИЧНЫЕ
	ДвиженияНоменклатура.Регистратор КАК Регистратор,
	ДвиженияНоменклатура.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	ДвиженияНоменклатура.Организация КАК Организация,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Серия КАК Серия,
	ДвиженияНоменклатура.КорСклад КАК Склад,
	ДвиженияНоменклатура.КорТипЗапасов КАК ТипЗапасов,
	ДвиженияНоменклатура.КорВидЗапасов КАК ВидЗапасов,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ДвиженияНоменклатура.КорКоличествоОборот, 0) = 0
				ТОГДА ТоварыНаСкладахОбороты.ВНаличииПриход
			ИНАЧЕ ДвиженияНоменклатура.КорКоличествоОборот
		КОНЕЦ) КАК Количество,
	СУММА(ДвиженияНоменклатура.СтоимостьБезНДСОборот) КАК Стоимость,
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "796"
					И ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесИспользовать = ИСТИНА
					И НЕ ЕСТЬNULL(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесЕдиницаИзмерения, ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
					И ПОДСТРОКА(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесЕдиницаИзмерения.Код, 0, 3) = "166"
					И НЕ ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесЗнаменатель = 0
				ТОГДА ВЫБОР
			КОГДА ЕСТЬNULL(ДвиженияНоменклатура.КорКоличествоОборот, 0) = 0
				ТОГДА ТоварыНаСкладахОбороты.ВНаличииПриход
			ИНАЧЕ ДвиженияНоменклатура.КорКоличествоОборот
		КОНЕЦ * ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесЧислитель / ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ВесЗнаменатель
			ИНАЧЕ ВЫБОР
					КОГДА ПОДСТРОКА(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "166"
						ТОГДА ВЫБОР
			КОГДА ЕСТЬNULL(ДвиженияНоменклатура.КорКоличествоОборот, 0) = 0
				ТОГДА ТоварыНаСкладахОбороты.ВНаличииПриход
			ИНАЧЕ ДвиженияНоменклатура.КорКоличествоОборот
		КОНЕЦ
					ИНАЧЕ 0
				КОНЕЦ
		КОНЕЦ) КАК Кг,
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "796"
				ТОГДА ВЫБОР
			КОГДА ЕСТЬNULL(ДвиженияНоменклатура.КорКоличествоОборот, 0) = 0
				ТОГДА ТоварыНаСкладахОбороты.ВНаличииПриход
			ИНАЧЕ ДвиженияНоменклатура.КорКоличествоОборот
		КОНЕЦ
			ИНАЧЕ 0
		КОНЕЦ) КАК Шт,
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "199"
				ТОГДА ВЫБОР
			КОГДА ЕСТЬNULL(ДвиженияНоменклатура.КорКоличествоОборот, 0) = 0
				ТОГДА ТоварыНаСкладахОбороты.ВНаличииПриход
			ИНАЧЕ ДвиженияНоменклатура.КорКоличествоОборот
		КОНЕЦ
			ИНАЧЕ 0
		КОНЕЦ) КАК М2,
	ДвиженияНоменклатура.Период КАК Период,
	ВЫБОР
		КОГДА ДвиженияНоменклатура.Регистратор ССЫЛКА Документ.ДвижениеПродукцииИМатериалов
			ТОГДА ВЫРАЗИТЬ(ДвиженияНоменклатура.Регистратор КАК Документ.ДвижениеПродукцииИМатериалов).ВИЛС_ЗаказКлиента
		ИНАЧЕ NULL
	КОНЕЦ КАК ЗаказКлиента
ПОМЕСТИТЬ ВыпускГП
ИЗ
	РегистрНакопления.ДвиженияНоменклатураНоменклатура.Обороты(&amp;НачалоПериода {(&amp;НачалоПериода)}, &amp;КонецПериода {(&amp;КонецПериода)}, Регистратор, ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)) КАК ДвиженияНоменклатура
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Обороты(&amp;НачалоПериода {(&amp;НачалоПериода)}, &amp;КонецПериода {(&amp;КонецПериода)}, Регистратор, ) КАК ТоварыНаСкладахОбороты
			ПО (ДвиженияНоменклатура.Регистратор = ТоварыНаСкладахОбороты.Регистратор)
				И (ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура = ТоварыНаСкладахОбороты.Номенклатура)
				И (ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Характеристика = ТоварыНаСкладахОбороты.Характеристика)
				И (ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Серия = ТоварыНаСкладахОбороты.Серия)
				И (ДвиженияНоменклатура.КорСклад = ТоварыНаСкладахОбороты.Склад)

{ГДЕ
	ДвиженияНоменклатура.Организация.*,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура.* КАК Номенклатура,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Характеристика.* КАК Характеристика,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Серия.* КАК Серия,
	ДвиженияНоменклатура.КорСклад.* КАК Склад,
	ДвиженияНоменклатура.КорТипЗапасов.* КАК ТипЗапасов,
	ДвиженияНоменклатура.КорВидЗапасов.* КАК ВидЗапасов}

СГРУППИРОВАТЬ ПО
	ДвиженияНоменклатура.Организация,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Характеристика,
	ДвиженияНоменклатура.ХозяйственнаяОперация,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Серия,
	ДвиженияНоменклатура.КорВидЗапасов,
	ДвиженияНоменклатура.Регистратор,
	ДвиженияНоменклатура.КорТипЗапасов,
	ДвиженияНоменклатура.КорАналитикаУчетаНоменклатуры.Номенклатура,
	ДвиженияНоменклатура.КорСклад,
	ДвиженияНоменклатура.Период,
	ВЫБОР
		КОГДА ДвиженияНоменклатура.Регистратор ССЫЛКА Документ.ДвижениеПродукцииИМатериалов
			ТОГДА ВЫРАЗИТЬ(ДвиженияНоменклатура.Регистратор КАК Документ.ДвижениеПродукцииИМатериалов).ВИЛС_ЗаказКлиента
		ИНАЧЕ NULL
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ХозрасчетныйОборотыДтКт.Регистратор,
	РеализацияТоваровУслугТовары.Ссылка.ХозяйственнаяОперация,
	ХозрасчетныйОборотыДтКт.Организация,
	ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.СубконтоКт3 КАК Справочник.Номенклатура),
	РеализацияТоваровУслугТовары.Характеристика,
	РеализацияТоваровУслугТовары.Серия,
	РеализацияТоваровУслугТовары.Ссылка.Склад,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов.ТипЗапасов,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов,
	СУММА(РеализацияТоваровУслугТовары.Количество),
	СУММА(РеализацияТоваровУслугТовары.СуммаСНДС - РеализацияТоваровУслугТовары.СуммаНДС),
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(РеализацияТоваровУслугТовары.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "796"
					И РеализацияТоваровУслугТовары.Номенклатура.ВесИспользовать = ИСТИНА
					И НЕ ЕСТЬNULL(РеализацияТоваровУслугТовары.Номенклатура.ВесЕдиницаИзмерения, ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
					И ПОДСТРОКА(РеализацияТоваровУслугТовары.Номенклатура.ВесЕдиницаИзмерения.Код, 0, 3) = "166"
					И НЕ РеализацияТоваровУслугТовары.Номенклатура.ВесЗнаменатель = 0
				ТОГДА РеализацияТоваровУслугТовары.Количество * РеализацияТоваровУслугТовары.Номенклатура.ВесЧислитель / РеализацияТоваровУслугТовары.Номенклатура.ВесЗнаменатель
			ИНАЧЕ ВЫБОР
					КОГДА ПОДСТРОКА(РеализацияТоваровУслугТовары.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "166"
						ТОГДА РеализацияТоваровУслугТовары.Количество
					ИНАЧЕ 0
				КОНЕЦ
		КОНЕЦ),
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(РеализацияТоваровУслугТовары.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "796"
				ТОГДА РеализацияТоваровУслугТовары.Количество
			ИНАЧЕ 0
		КОНЕЦ),
	СУММА(ВЫБОР
			КОГДА ПОДСТРОКА(РеализацияТоваровУслугТовары.Номенклатура.ЕдиницаИзмерения.Код, 0, 3) = "199"
				ТОГДА РеализацияТоваровУслугТовары.Количество
			ИНАЧЕ 0
		КОНЕЦ),
	ХозрасчетныйОборотыДтКт.Период,
	ВЫБОР
		КОГДА ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.Регистратор КАК Документ.РеализацияТоваровУслуг).ЗаказКлиента
		ИНАЧЕ NULL
	КОНЕЦ
ИЗ
	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&amp;НачалоПериода {(&amp;НачалоПериода)}, &amp;КонецПериода {(&amp;КонецПериода)}, Регистратор, СчетДт.Родитель = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыСПокупателямиИЗаказчиками), , СчетКт.Родитель = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.Выручка), , ) КАК ХозрасчетныйОборотыДтКт
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.ВидыЗапасов КАК РеализацияТоваровУслугВидыЗапасов
			ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслугВидыЗапасов.Ссылка
				И РеализацияТоваровУслугТовары.ИдентификаторСтроки = РеализацияТоваровУслугВидыЗапасов.ИдентификаторСтроки
		ПО ХозрасчетныйОборотыДтКт.Регистратор = РеализацияТоваровУслугТовары.Ссылка
			И ((ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.СубконтоКт3 КАК Справочник.Номенклатура)) = РеализацияТоваровУслугТовары.Номенклатура)
{ГДЕ
	РеализацияТоваровУслугТовары.Ссылка.ХозяйственнаяОперация.*,
	ХозрасчетныйОборотыДтКт.Организация.*,
	(ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.СубконтоКт3 КАК Справочник.Номенклатура)).* КАК Номенклатура,
	РеализацияТоваровУслугТовары.Характеристика.*,
	РеализацияТоваровУслугТовары.Серия.*,
	РеализацияТоваровУслугТовары.Ссылка.Склад.*,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов.ТипЗапасов.* КАК ТипЗапасов,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов.*}

СГРУППИРОВАТЬ ПО
	РеализацияТоваровУслугТовары.Ссылка.ХозяйственнаяОперация,
	ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.СубконтоКт3 КАК Справочник.Номенклатура),
	ХозрасчетныйОборотыДтКт.Регистратор,
	РеализацияТоваровУслугТовары.Серия,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов,
	ХозрасчетныйОборотыДтКт.Организация,
	РеализацияТоваровУслугТовары.Характеристика,
	РеализацияТоваровУслугТовары.Ссылка.Склад,
	ХозрасчетныйОборотыДтКт.Период,
	РеализацияТоваровУслугВидыЗапасов.ВидЗапасов.ТипЗапасов,
	ВЫБОР
		КОГДА ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОборотыДтКт.Регистратор КАК Документ.РеализацияТоваровУслуг).ЗаказКлиента
		ИНАЧЕ NULL
	КОНЕЦ

ИНДЕКСИРОВАТЬ ПО
	ЗаказКлиента,
	Номенклатура,
	Характеристика,
	Серия
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ЗаказыКлиентов.ЗаказКлиента КАК ЗаказКлиента,
	ЗаказыКлиентов.Номенклатура КАК Номенклатура,
	ЗаказыКлиентов.Характеристика КАК Характеристика,
	ЗаказыКлиентов.Серия КАК Серия,
	СУММА(ЗаказыКлиентов.ЗаказаноПриход) КАК КоличествоЗаказано,
	СУММА(ЗаказыКлиентов.СуммаПриход) КАК СуммаЗаказано,
	ЗаказыКлиентов.Период КАК Период,
	ЗаказыКлиентов.ЗаказКлиента.НалогообложениеНДС КАК ЗаказКлиентаНалогообложениеНДС
ПОМЕСТИТЬ ЗаказыКиентов
ИЗ
	РегистрНакопления.ЗаказыКлиентов.Обороты(
			&amp;НачалоПериодаВремен {(&amp;НачалоПериодаВремен)},
			&amp;КонецПериода {(&amp;КонецПериода)},
			Регистратор,
			Номенклатура В
					(ВЫБРАТЬ РАЗЛИЧНЫЕ
						ВыпускГП.Номенклатура
					ИЗ
						ВыпускГП КАК ВыпускГП)
				И Характеристика В
					(ВЫБРАТЬ РАЗЛИЧНЫЕ
						ВыпускГП.Характеристика
					ИЗ
						ВыпускГП КАК ВыпускГП)) КАК ЗаказыКлиентов
{ГДЕ
	ЗаказыКлиентов.ЗаказКлиента.*,
	ЗаказыКлиентов.Номенклатура.*,
	ЗаказыКлиентов.Характеристика.*}

СГРУППИРОВАТЬ ПО
	ЗаказыКлиентов.ЗаказКлиента,
	ЗаказыКлиентов.Характеристика,
	ЗаказыКлиентов.Номенклатура,
	ЗаказыКлиентов.Период,
	ЗаказыКлиентов.ЗаказКлиента.НалогообложениеНДС,
	ЗаказыКлиентов.Серия

ИМЕЮЩИЕ
	НЕ(СУММА(ЗаказыКлиентов.ЗаказаноПриход) = 0
			И СУММА(ЗаказыКлиентов.СуммаПриход) = 0)

ИНДЕКСИРОВАТЬ ПО
	ЗаказКлиента,
	Номенклатура,
	Характеристика,
	Серия
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ЗаказыКлиентовОбороты.ЗаказКлиента КАК ЗаказКлиента,
	ЗаказыКлиентовОбороты.Номенклатура КАК Номенклатура,
	ЗаказыКлиентовОбороты.Характеристика КАК Характеристика,
	ЗаказыКлиентовОбороты.Серия КАК Серия,
	СУММА(ЗаказыКлиентовОбороты.КоличествоЗаказано) КАК КоличествоЗаказано,
	СУММА(ЗаказыКлиентовОбороты.СуммаЗаказано) КАК СуммаЗаказано,
	ЗаказыКлиентовОбороты.Период КАК Период,
	ВЫБОР
		КОГДА ЗаказыКлиентовОбороты.ЗаказКлиентаНалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
			ТОГДА 0
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
			ТОГДА 20 / 120
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 20 / 120
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
			ТОГДА 18 / 118
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 18 / 118
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
			ТОГДА 10 / 110
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 10 / 110
		ИНАЧЕ 0
	КОНЕЦ КАК КоэффициентНДС,
	ЗаказыКлиентовОбороты.ЗаказКлиентаНалогообложениеНДС КАК ЗаказКлиентаНалогообложениеНДС
ПОМЕСТИТЬ Заказы
ИЗ
	ЗаказыКиентов КАК ЗаказыКлиентовОбороты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		ПО ЗаказыКлиентовОбороты.ЗаказКлиента = ЗаказКлиентаТовары.Ссылка
			И ЗаказыКлиентовОбороты.Номенклатура = ЗаказКлиентаТовары.Номенклатура
			И ЗаказыКлиентовОбороты.Характеристика = ЗаказКлиентаТовары.Характеристика
			И ЗаказыКлиентовОбороты.Серия = ЗаказКлиентаТовары.Серия
{ГДЕ
	ЗаказыКлиентовОбороты.ЗаказКлиента.*,
	ЗаказыКлиентовОбороты.Номенклатура.*,
	ЗаказыКлиентовОбороты.Характеристика.*}

СГРУППИРОВАТЬ ПО
	ЗаказыКлиентовОбороты.ЗаказКлиента,
	ЗаказыКлиентовОбороты.Характеристика,
	ЗаказыКлиентовОбороты.Номенклатура,
	ЗаказыКлиентовОбороты.Период,
	ВЫБОР
		КОГДА ЗаказыКлиентовОбороты.ЗаказКлиентаНалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
			ТОГДА 0
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
			ТОГДА 20 / 120
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 20 / 120
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
			ТОГДА 18 / 118
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 18 / 118
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
			ТОГДА 10 / 110
		КОГДА ЗаказКлиентаТовары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 10 / 110
		ИНАЧЕ 0
	КОНЕЦ,
	ЗаказыКлиентовОбороты.ЗаказКлиентаНалогообложениеНДС,
	ЗаказыКлиентовОбороты.Серия

ИМЕЮЩИЕ
	НЕ(СУММА(ЗаказыКлиентовОбороты.КоличествоЗаказано) = 0
			И СУММА(ЗаказыКлиентовОбороты.СуммаЗаказано) = 0)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЗаказыКиентов.ЗаказКлиента,
	ЗаказыКиентов.Номенклатура,
	ЗаказыКиентов.Характеристика,
	ЗаказыКиентов.Серия,
	ЗаказыКиентов.КоличествоЗаказано,
	ВЫБОР
		КОГДА ЕСТЬNULL(СУММА(УслугиДавальцуОбороты.ЗаказаноПриход), 0) = 0
			ТОГДА 0
		ИНАЧЕ ЕСТЬNULL(СУММА(ЗаказыКиентов.КоличествоЗаказано) * СУММА(УслугиДавальцуОбороты.СуммаПриход) / СУММА(УслугиДавальцуОбороты.ЗаказаноПриход), 0)
	КОНЕЦ,
	ЗаказыКиентов.Период,
	ВЫБОР
		КОГДА ЗаказыКиентов.ЗаказКлиентаНалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
			ТОГДА 0
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
			ТОГДА 20 / 120
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 20 / 120
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
			ТОГДА 18 / 118
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 18 / 118
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
			ТОГДА 10 / 110
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 10 / 110
		ИНАЧЕ 0
	КОНЕЦ,
	ЗаказыКиентов.ЗаказКлиентаНалогообложениеНДС
ИЗ
	ЗаказыКиентов КАК ЗаказыКиентов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.УслугиДавальцуКОформлению.Обороты(
				&amp;НачалоПериодаВремен {(&amp;НачалоПериодаВремен)},
				&amp;КонецПериода {(&amp;КонецПериода)},
				,
				Номенклатура В
						(ВЫБРАТЬ РАЗЛИЧНЫЕ
							ВыпускГП.Номенклатура
						ИЗ
							ВыпускГП КАК ВыпускГП)
					И Характеристика В
						(ВЫБРАТЬ РАЗЛИЧНЫЕ
							ВыпускГП.Характеристика
						ИЗ
							ВыпускГП КАК ВыпускГП)) КАК УслугиДавальцуОбороты
		ПО ЗаказыКиентов.ЗаказКлиента = УслугиДавальцуОбороты.ЗаказДавальца
			И ЗаказыКиентов.Номенклатура = УслугиДавальцуОбороты.Номенклатура
			И ЗаказыКиентов.Характеристика = УслугиДавальцуОбороты.Характеристика

СГРУППИРОВАТЬ ПО
	ЗаказыКиентов.ЗаказКлиента,
	ЗаказыКиентов.Номенклатура,
	ЗаказыКиентов.Характеристика,
	ЗаказыКиентов.Серия,
	ЗаказыКиентов.КоличествоЗаказано,
	ЗаказыКиентов.Период,
	ЗаказыКиентов.ЗаказКлиентаНалогообложениеНДС,
	ВЫБОР
		КОГДА ЗаказыКиентов.ЗаказКлиентаНалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
			ТОГДА 0
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
			ТОГДА 20 / 120
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 20 / 120
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
			ТОГДА 18 / 118
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 18 / 118
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
			ТОГДА 10 / 110
		КОГДА УслугиДавальцуОбороты.ЗаказДавальца.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 10 / 110
		ИНАЧЕ 0
	КОНЕЦ

ИМЕЮЩИЕ
	НЕ(СУММА(ЗаказыКиентов.КоличествоЗаказано) = 0
			И ВЫБОР
				КОГДА ЕСТЬNULL(СУММА(УслугиДавальцуОбороты.ЗаказаноПриход), 0) = 0
					ТОГДА 0
				ИНАЧЕ ЕСТЬNULL(СУММА(ЗаказыКиентов.КоличествоЗаказано) * СУММА(УслугиДавальцуОбороты.СуммаПриход) / СУММА(УслугиДавальцуОбороты.ЗаказаноПриход), 0)
			КОНЕЦ = 0)

ИНДЕКСИРОВАТЬ ПО
	ЗаказКлиента,
	Номенклатура,
	Характеристика,
	Серия
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.Регистратор КАК Регистратор,
	ВложенныйЗапрос.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	ВложенныйЗапрос.Организация КАК Организация,
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.Характеристика КАК Характеристика,
	ВложенныйЗапрос.Серия КАК Серия,
	ВложенныйЗапрос.Склад КАК Склад,
	ВложенныйЗапрос.ТипЗапасов КАК ТипЗапасов,
	ВложенныйЗапрос.ВидЗапасов КАК ВидЗапасов,
	ВложенныйЗапрос.Период КАК Период,
	ВложенныйЗапрос.ПериодЗаказа КАК ПериодЗаказа,
	СУММА(ВложенныйЗапрос.Количество) КАК Количество,
	СУММА(ВложенныйЗапрос.Стоимость) КАК Стоимость,
	СУММА(ВложенныйЗапрос.Кг) КАК Кг,
	СУММА(ВложенныйЗапрос.Шт) КАК Шт,
	СУММА(ВложенныйЗапрос.М2) КАК М2,
	Заказы.ЗаказКлиента КАК ЗаказКлиента,
	СУММА(Заказы.КоличествоЗаказано) КАК КоличествоЗаказано,
	СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС) КАК СуммаЗаказано,
	ВЫБОР
		КОГДА СУММА(Заказы.КоличествоЗаказано) = 0
			ТОГДА 0
		ИНАЧЕ СУММА(ВложенныйЗапрос.Количество) * (СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС)) / СУММА(Заказы.КоличествоЗаказано)
	КОНЕЦ КАК ОтпускнаяСтоимость,
	ВЫБОР
		КОГДА СУММА(Заказы.КоличествоЗаказано) = 0
			ТОГДА 0
		ИНАЧЕ (СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС)) / СУММА(Заказы.КоличествоЗаказано)
	КОНЕЦ КАК ЦенаПоЗаказу,
	ВЫБОР
		КОГДА Заказы.ЗаказКлиента ЕСТЬ NULL
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ПоЗаказу
{ВЫБРАТЬ
	Регистратор.*,
	ХозяйственнаяОперация.*,
	Организация.*,
	Номенклатура.*,
	Характеристика.*,
	Серия.*,
	Склад.*,
	ТипЗапасов.*,
	ВидЗапасов.*,
	Период,
	ПериодЗаказа,
	Количество,
	Стоимость,
	Кг,
	Шт,
	М2,
	ЗаказКлиента.*,
	КоличествоЗаказано,
	СуммаЗаказано,
	ОтпускнаяСтоимость,
	ЦенаПоЗаказу,
	ПоЗаказу}
ИЗ
	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		ВыпускГП.Регистратор КАК Регистратор,
		ВыпускГП.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		ВыпускГП.Организация КАК Организация,
		ВыпускГП.Номенклатура КАК Номенклатура,
		ВыпускГП.Характеристика КАК Характеристика,
		ВыпускГП.Серия КАК Серия,
		ВыпускГП.Склад КАК Склад,
		ВыпускГП.ТипЗапасов КАК ТипЗапасов,
		ВыпускГП.ВидЗапасов КАК ВидЗапасов,
		ВыпускГП.Период КАК Период,
		МАКСИМУМ(Заказы.Период) КАК ПериодЗаказа,
		СУММА(ВыпускГП.Количество) КАК Количество,
		СУММА(ВыпускГП.Стоимость) КАК Стоимость,
		СУММА(ВыпускГП.Кг) КАК Кг,
		СУММА(ВыпускГП.Шт) КАК Шт,
		СУММА(ВыпускГП.М2) КАК М2
	ИЗ
		ВыпускГП КАК ВыпускГП
			ЛЕВОЕ СОЕДИНЕНИЕ Заказы КАК Заказы
			ПО ВыпускГП.Номенклатура = Заказы.Номенклатура
				И ВыпускГП.Характеристика = Заказы.Характеристика
				И ВыпускГП.Серия = Заказы.Серия
				И ВыпускГП.Период &gt;= Заказы.Период
	ГДЕ
		ЕСТЬNULL(ВыпускГП.ЗаказКлиента, ЗНАЧЕНИЕ(Документ.ЗаказКлиента.ПустаяСсылка)) = ЗНАЧЕНИЕ(Документ.ЗаказКлиента.ПустаяСсылка)
	{ГДЕ
		ВыпускГП.ХозяйственнаяОперация.*,
		ВыпускГП.Организация.*,
		ВыпускГП.Номенклатура.*,
		ВыпускГП.Характеристика.*,
		ВыпускГП.Серия.*,
		ВыпускГП.Склад.*,
		ВыпускГП.ТипЗапасов.*,
		ВыпускГП.ВидЗапасов.*}
	
	СГРУППИРОВАТЬ ПО
		ВыпускГП.Регистратор,
		ВыпускГП.Период,
		ВыпускГП.Организация,
		ВыпускГП.Склад,
		ВыпускГП.ТипЗапасов,
		ВыпускГП.Серия,
		ВыпускГП.ВидЗапасов,
		ВыпускГП.Характеристика,
		ВыпускГП.Номенклатура,
		ВыпускГП.ХозяйственнаяОперация) КАК ВложенныйЗапрос
		ЛЕВОЕ СОЕДИНЕНИЕ Заказы КАК Заказы
		ПО ВложенныйЗапрос.Номенклатура = Заказы.Номенклатура
			И ВложенныйЗапрос.Характеристика = Заказы.Характеристика
			И ВложенныйЗапрос.Серия = Заказы.Серия
			И ВложенныйЗапрос.ПериодЗаказа = Заказы.Период
{ГДЕ
	ВложенныйЗапрос.Организация.*,
	ВложенныйЗапрос.Номенклатура.*,
	ВложенныйЗапрос.Характеристика.*,
	ВложенныйЗапрос.Серия.*,
	ВложенныйЗапрос.Склад.*,
	ВложенныйЗапрос.ТипЗапасов.*,
	ВложенныйЗапрос.ВидЗапасов.*,
	Заказы.ЗаказКлиента.*,
	(ВЫБОР
			КОГДА Заказы.ЗаказКлиента ЕСТЬ NULL
				ТОГДА ЛОЖЬ
			ИНАЧЕ ИСТИНА
		КОНЕЦ) КАК ПоЗаказу}

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.Серия,
	ВложенныйЗапрос.Склад,
	ВложенныйЗапрос.ПериодЗаказа,
	ВложенныйЗапрос.Номенклатура,
	ВложенныйЗапрос.ХозяйственнаяОперация,
	ВложенныйЗапрос.ТипЗапасов,
	ВложенныйЗапрос.Организация,
	ВложенныйЗапрос.Характеристика,
	ВложенныйЗапрос.ВидЗапасов,
	ВложенныйЗапрос.Период,
	ВложенныйЗапрос.Регистратор,
	Заказы.ЗаказКлиента,
	ВЫБОР
		КОГДА Заказы.ЗаказКлиента ЕСТЬ NULL
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВыпускГП.Регистратор,
	ВыпускГП.ХозяйственнаяОперация,
	ВыпускГП.Организация,
	ВыпускГП.Номенклатура,
	ВыпускГП.Характеристика,
	ВыпускГП.Серия,
	ВыпускГП.Склад,
	ВыпускГП.ТипЗапасов,
	ВыпускГП.ВидЗапасов,
	ВыпускГП.Период,
	NULL,
	СУММА(ВыпускГП.Количество),
	СУММА(ВыпускГП.Стоимость),
	СУММА(ВыпускГП.Кг),
	СУММА(ВыпускГП.Шт),
	СУММА(ВыпускГП.М2),
	ВыпускГП.ЗаказКлиента,
	СУММА(Заказы.КоличествоЗаказано),
	СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС),
	ВЫБОР
		КОГДА СУММА(Заказы.КоличествоЗаказано) = 0
			ТОГДА 0
		ИНАЧЕ СУММА(ВыпускГП.Количество) * (СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС)) / СУММА(Заказы.КоличествоЗаказано)
	КОНЕЦ,
	ВЫБОР
		КОГДА СУММА(Заказы.КоличествоЗаказано) = 0
			ТОГДА 0
		ИНАЧЕ (СУММА(Заказы.СуммаЗаказано) - СУММА(Заказы.СуммаЗаказано) * МИНИМУМ(Заказы.КоэффициентНДС)) / СУММА(Заказы.КоличествоЗаказано)
	КОНЕЦ,
	ВЫБОР
		КОГДА ВыпускГП.ЗаказКлиента ЕСТЬ NULL
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ
ИЗ
	ВыпускГП КАК ВыпускГП
		ЛЕВОЕ СОЕДИНЕНИЕ Заказы КАК Заказы
		ПО ВыпускГП.ЗаказКлиента = Заказы.ЗаказКлиента
			И ВыпускГП.Номенклатура = Заказы.Номенклатура
			И ВыпускГП.Характеристика = Заказы.Характеристика
			И ВыпускГП.Серия = Заказы.Серия
ГДЕ
	НЕ ЕСТЬNULL(ВыпускГП.ЗаказКлиента, ЗНАЧЕНИЕ(Документ.ЗаказКлиента.ПустаяСсылка)) = ЗНАЧЕНИЕ(Документ.ЗаказКлиента.ПустаяСсылка)
	И НЕ ЕСТЬNULL(Заказы.Номенклатура, ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)

СГРУППИРОВАТЬ ПО
	ВыпускГП.ХозяйственнаяОперация,
	ВыпускГП.Номенклатура,
	ВыпускГП.Характеристика,
	ВыпускГП.Склад,
	ВыпускГП.ВидЗапасов,
	ВыпускГП.Серия,
	ВыпускГП.ЗаказКлиента,
	ВыпускГП.Регистратор,
	ВыпускГП.Организация,
	ВыпускГП.ТипЗапасов,
	ВыпускГП.Период,
	ВЫБОР
		КОГДА ВыпускГП.ЗаказКлиента ЕСТЬ NULL
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ

УПОРЯДОЧИТЬ ПО
	Номенклатура,
	Характеристика,
	ЗаказКлиента,
	Регистратор
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ВыпускГП
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ Заказы</query>
	</dataSet>
	<totalField>
		<dataPath>Кг</dataPath>
		<expression>Сумма(Кг)</expression>
	</totalField>
	<totalField>
		<dataPath>Количество</dataPath>
		<expression>Сумма(Количество)</expression>
	</totalField>
	<totalField>
		<dataPath>КоличествоЗаказано</dataPath>
		<expression>Сумма(КоличествоЗаказано)</expression>
	</totalField>
	<totalField>
		<dataPath>М2</dataPath>
		<expression>Сумма(М2)</expression>
	</totalField>
	<totalField>
		<dataPath>Стоимость</dataPath>
		<expression>Сумма(Стоимость)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаЗаказано</dataPath>
		<expression>Сумма(СуммаЗаказано)</expression>
	</totalField>
	<totalField>
		<dataPath>Шт</dataPath>
		<expression>Сумма(Шт)</expression>
	</totalField>
	<totalField>
		<dataPath>ОтпускнаяСтоимость</dataPath>
		<expression>Сумма(ОтпускнаяСтоимость)</expression>
	</totalField>
	<totalField>
		<dataPath>ЦенаПоЗаказу</dataPath>
		<expression>(ЦенаПоЗаказу)</expression>
	</totalField>
	<totalField>
		<dataPath>ЦенаПоЗаказу</dataPath>
		<expression>0</expression>
		<group>ОбщийИтог</group>
	</totalField>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>v8:StandardPeriod</v8:Type>
		</valueType>
		<value xsi:type="v8:StandardPeriod">
			<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
			<v8:startDate>0001-01-01T00:00:00</v8:startDate>
			<v8:endDate>0001-01-01T00:00:00</v8:endDate>
		</value>
		<useRestriction>false</useRestriction>
		<inputParameters>
			<dcscor:item>
				<dcscor:parameter>БыстрыйВыбор</dcscor:parameter>
				<dcscor:value xsi:type="xs:boolean">true</dcscor:value>
			</dcscor:item>
		</inputParameters>
		<use>Always</use>
	</parameter>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;Период.ДатаНачала</expression>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;Период.ДатаОкончания</expression>
	</parameter>
	<parameter>
		<name>НачалоПериодаВремен</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода времен</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">1980-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<denyIncompleteValues>true</denyIncompleteValues>
		<use>Always</use>
	</parameter>
	<settingsVariant>
		<dcsset:name>ВыпускПродукцииПоОтпускнойСтоимости</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Выпуск продукции по отпускной стоимости (кг, шт, м2) (ВИЛС)</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Количество</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЦенаПоЗаказу</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Стоимость</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОтпускнаяСтоимость</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Кг</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Шт</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>М2</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:filter>
				<dcsset:item xsi:type="dcsset:FilterItemGroup">
					<dcsset:groupType>AndGroup</dcsset:groupType>
					<dcsset:item xsi:type="dcsset:FilterItemComparison">
						<dcsset:left xsi:type="dcscor:Field">ПоЗаказу</dcsset:left>
						<dcsset:comparisonType>Equal</dcsset:comparisonType>
						<dcsset:right xsi:type="xs:boolean">true</dcsset:right>
					</dcsset:item>
					<dcsset:presentation xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Только по заказу покупателя</v8:content>
						</v8:item>
					</dcsset:presentation>
					<dcsset:userSettingID>d7bf98a5-0eb2-46fd-8f18-d61350bac990</dcsset:userSettingID>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Номенклатура</dcsset:left>
					<dcsset:comparisonType>InListByHierarchy</dcsset:comparisonType>
					<dcsset:right xsi:type="v8:ValueListType">
						<v8:valueType/>
						<v8:lastId xsi:type="xs:decimal">-1</v8:lastId>
					</dcsset:right>
					<dcsset:userSettingID>f74f2c84-002a-4018-a497-7a0c59637bef</dcsset:userSettingID>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Склад</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:userSettingID>3aea2b06-6d99-4340-b61f-482b0690838c</dcsset:userSettingID>
				</dcsset:item>
			</dcsset:filter>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:use>false</dcscor:use>
					<dcscor:parameter>Период</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardPeriod">
						<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
						<v8:startDate>0001-01-01T00:00:00</v8:startDate>
						<v8:endDate>0001-01-01T00:00:00</v8:endDate>
					</dcscor:value>
					<dcsset:userSettingID>28c3f68c-9023-42fc-af4b-ac8d27b9dceb</dcsset:userSettingID>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:order>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>Номенклатура</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>Характеристика</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>ЗаказКлиента</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>ЦенаПоЗаказу</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>Регистратор</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
			</dcsset:order>
			<dcsset:conditionalAppearance>
				<dcsset:item>
					<dcsset:selection>
						<dcsset:item>
							<dcsset:field>Кг</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>Количество</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>КоличествоЗаказано</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>М2</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ОтпускнаяСтоимость</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>Стоимость</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>СуммаЗаказано</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ЦенаПоЗаказу</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>Шт</dcsset:field>
						</dcsset:item>
					</dcsset:selection>
					<dcsset:filter/>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ГоризонтальноеПоложение</dcscor:parameter>
							<dcscor:value xsi:type="v8ui:HorizontalAlign">Center</dcscor:value>
						</dcscor:item>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ВертикальноеПоложение</dcscor:parameter>
							<dcscor:value xsi:type="v8ui:VerticalAlign">Top</dcscor:value>
						</dcscor:item>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>МинимальнаяШирина</dcscor:parameter>
							<dcscor:value xsi:type="xs:decimal">15</dcscor:value>
						</dcscor:item>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>МаксимальнаяШирина</dcscor:parameter>
							<dcscor:value xsi:type="xs:decimal">15</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
					<dcsset:useInGroup>DontUse</dcsset:useInGroup>
					<dcsset:useInHierarchicalGroup>DontUse</dcsset:useInHierarchicalGroup>
					<dcsset:useInOverall>DontUse</dcsset:useInOverall>
					<dcsset:useInHeader>DontUse</dcsset:useInHeader>
					<dcsset:useInParameters>DontUse</dcsset:useInParameters>
					<dcsset:useInFilter>DontUse</dcsset:useInFilter>
				</dcsset:item>
			</dcsset:conditionalAppearance>
			<dcsset:outputParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Заголовок</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Выпуск продукции по отпускной стоимости (кг, шт, м2) (ВИЛС)</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</dcsset:outputParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:groupItems>
					<dcsset:item xsi:type="dcsset:GroupItemField">
						<dcsset:field>Номенклатура</dcsset:field>
						<dcsset:groupType>Items</dcsset:groupType>
						<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
						<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
						<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
					</dcsset:item>
				</dcsset:groupItems>
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
				<dcsset:item xsi:type="dcsset:StructureItemGroup">
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>Характеристика</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
					<dcsset:item xsi:type="dcsset:StructureItemGroup">
						<dcsset:groupItems>
							<dcsset:item xsi:type="dcsset:GroupItemField">
								<dcsset:field>ЗаказКлиента</dcsset:field>
								<dcsset:groupType>Items</dcsset:groupType>
								<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
								<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
								<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
							</dcsset:item>
						</dcsset:groupItems>
						<dcsset:order>
							<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
						</dcsset:order>
						<dcsset:selection>
							<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
						</dcsset:selection>
						<dcsset:item xsi:type="dcsset:StructureItemGroup">
							<dcsset:groupItems>
								<dcsset:item xsi:type="dcsset:GroupItemField">
									<dcsset:field>Регистратор</dcsset:field>
									<dcsset:groupType>Items</dcsset:groupType>
									<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
									<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
									<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
								</dcsset:item>
							</dcsset:groupItems>
							<dcsset:order>
								<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
							</dcsset:order>
							<dcsset:selection>
								<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
							</dcsset:selection>
						</dcsset:item>
					</dcsset:item>
				</dcsset:item>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>