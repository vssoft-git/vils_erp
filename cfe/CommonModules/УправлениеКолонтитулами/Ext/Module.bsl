
Процедура ОчиститьКолонтитул(Колонтитул)
	Колонтитул.ТекстСлева = "";
	Колонтитул.ТекстВЦентре = "";
	Колонтитул.ТекстСправа = "";
КонецПроцедуры

//&После("УстановитьКолонтитулы")
//Процедура ВИЛС_УстановитьКолонтитулы(ТабличныйДокумент, НазваниеОтчета, Пользователь, НастройкиКолонтитулов)
//	// begin fix Suetin 18.09.2020 3:18:26 Очистим колонтитулы
//	Если НазваниеОтчета = "Список граждан для сверки с военкоматом" 
//		или НазваниеОтчета = "Извещение о приеме или увольнении" 
//		или НазваниеОтчета = "Расчетный листок" Тогда
//		ОчиститьКолонтитул(ТабличныйДокумент.ВерхнийКолонтитул);
//		ОчиститьКолонтитул(ТабличныйДокумент.НижнийКолонтитул);
//	КонецЕсли;
//	// end fix Suetin 18.09.2020 3:23:56
//КонецПроцедуры

&ИзменениеИКонтроль("УстановитьКолонтитулы")
Процедура ВИЛС_УстановитьКолонтитулы(ТабличныйДокумент, НазваниеОтчета = "", Пользователь = Неопределено, НастройкиКолонтитулов = Неопределено) Экспорт
	Если Пользователь = Неопределено Тогда
		Пользователь = Пользователи.АвторизованныйПользователь();
	КонецЕсли;
	
	Если НастройкиКолонтитулов = Неопределено Тогда 
		НастройкиКолонтитулов = НастройкиКолонтитулов();
	КонецЕсли;
	
#Удаление	
	Если Не КолонтитулУстановлен(ТабличныйДокумент.ВерхнийКолонтитул) Тогда 
		СвойстваКолонтитула = СвойстваКолонтитула(НастройкиКолонтитулов.ВерхнийКолонтитул, НазваниеОтчета, Пользователь);
		ЗаполнитьЗначенияСвойств(ТабличныйДокумент.ВерхнийКолонтитул, СвойстваКолонтитула);
	КонецЕсли;
	
	Если Не КолонтитулУстановлен(ТабличныйДокумент.НижнийКолонтитул) Тогда 
		СвойстваКолонтитула = СвойстваКолонтитула(НастройкиКолонтитулов.НижнийКолонтитул, НазваниеОтчета, Пользователь);
		ЗаполнитьЗначенияСвойств(ТабличныйДокумент.НижнийКолонтитул, СвойстваКолонтитула);
	КонецЕсли;
#КонецУдаления
#Вставка
	// begin fix Suetin 17.11.2020 12:51:23
	Если НастройкиКолонтитулов.ВерхнийКолонтитул.Свойство("ВыводитьКолонтитул")
		и Не НастройкиКолонтитулов.ВерхнийКолонтитул.ВыводитьКолонтитул Тогда
		ОчиститьКолонтитул(ТабличныйДокумент.ВерхнийКолонтитул);
	Иначе
		СвойстваКолонтитула = СвойстваКолонтитула(НастройкиКолонтитулов.ВерхнийКолонтитул, НазваниеОтчета, Пользователь);
		СвойстваКолонтитула.ТекстСлева 		= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстСлева);
		СвойстваКолонтитула.ТекстВЦентре 	= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстВЦентре);
		СвойстваКолонтитула.ТекстСправа 	= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстСправа);
		ЗаполнитьЗначенияСвойств(ТабличныйДокумент.ВерхнийКолонтитул, СвойстваКолонтитула);
	КонецЕсли; 
	Если НастройкиКолонтитулов.НижнийКолонтитул.Свойство("ВыводитьКолонтитул")
		и Не НастройкиКолонтитулов.НижнийКолонтитул.ВыводитьКолонтитул Тогда
		ОчиститьКолонтитул(ТабличныйДокумент.НижнийКолонтитул);
	Иначе	
		СвойстваКолонтитула = СвойстваКолонтитула(НастройкиКолонтитулов.НижнийКолонтитул, НазваниеОтчета, Пользователь);
		СвойстваКолонтитула.ТекстСлева 		= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстСлева);
		СвойстваКолонтитула.ТекстВЦентре 	= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстВЦентре);
		СвойстваКолонтитула.ТекстСправа 	= ВИЛС_ВернутьСкорректированныйТекстКолонтитула(СвойстваКолонтитула.ТекстСправа);
		ЗаполнитьЗначенияСвойств(ТабличныйДокумент.НижнийКолонтитул, СвойстваКолонтитула);
	КонецЕсли; 
	// begin fix Suetin 18.09.2020 3:18:26 Очистим колонтитулы
	Если НазваниеОтчета = "Список граждан для сверки с военкоматом" 
		или НазваниеОтчета = "Извещение о приеме или увольнении" 
		или НазваниеОтчета = "Расчетный листок" Тогда
		ОчиститьКолонтитул(ТабличныйДокумент.ВерхнийКолонтитул);
		ОчиститьКолонтитул(ТабличныйДокумент.НижнийКолонтитул);
	КонецЕсли;
	// end fix Suetin 18.09.2020 3:23:56
	// end fix Suetin 17.11.2020 12:51:31
#КонецВставки
КонецПроцедуры

Функция ВИЛС_ВернутьСкорректированныйТекстКолонтитула(Знач Результат)
	МассивИсходныхСтрок = СтрРазделить(Результат, Символы.ПС, Истина);
	Для каждого ТекСтр Из МассивИсходныхСтрок Цикл
		Если СтрДлина(ТекСтр) > 60 Тогда
			МассивСтрок = СтрРазделить(ТекСтр, " ", Истина);
			Результат = "";
			МассивНовыйСтрок = Новый Массив();
			Для каждого ЭлМ Из МассивСтрок Цикл
				МассивНовыйСтрок.Добавить(ЭлМ);
				Если СтрДлина(СтрСоединить(МассивНовыйСтрок, " ")) > 60 Тогда
					МассивНовыйСтрок.Удалить(МассивНовыйСтрок.ВГраница());
					Результат = ?(СтрДлина(Результат) = 0, СтрСоединить(МассивНовыйСтрок, " "), СтрШаблон("%1%2%3", Результат, Символы.ПС, СтрСоединить(МассивНовыйСтрок, " ")));
				    МассивНовыйСтрок.Очистить();
					МассивНовыйСтрок.Добавить(ЭлМ);
				КонецЕсли;	
			КонецЦикла;
			Если МассивНовыйСтрок.Количество() Тогда
				Результат = ?(СтрДлина(Результат) = 0, СтрСоединить(МассивНовыйСтрок, " "), СтрШаблон("%1%2%3", Результат, Символы.ПС, СтрСоединить(МассивНовыйСтрок, " ")));
			КонецЕсли; 
		КонецЕсли; 
	КонецЦикла;
	Возврат(Результат);
КонецФункции // 1()
 