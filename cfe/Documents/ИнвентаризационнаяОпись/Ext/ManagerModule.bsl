
&Вместо("ПолучитьДанныеДокумента")   //  ИзменениеИКонтроль
Функция ВИЛС_ПолучитьДанныеДокумента(ПараметрыПечати, ДокументОснование)

	СтруктураВозврата = Новый Структура(
	"РезультатПоШапке, РезультатПоТабличнойЧасти, РезультатКурсВалюты, ОписаниеОшибки, ПоПредварительномуРасчету");
	СтруктураВозврата.ОписаниеОшибки = Неопределено;
	СтруктураВозврата.ПоПредварительномуРасчету = Ложь;

	УстановитьПривилегированныйРежим(Истина);

	КолонкаКодов = ФормированиеПечатныхФорм.ИмяДополнительнойКолонки();
	Если Не ЗначениеЗаполнено(КолонкаКодов) Тогда
		КолонкаКодов = "Код";
	КонецЕсли;

	ЗапросПредварительныхДанных = Новый Запрос;
	ЗапросПредварительныхДанных.Текст = 
	"ВЫБРАТЬ
	|	ИнвентаризационнаяОпись.Дата КАК Дата,
	|	ИнвентаризационнаяОпись.ДатаНачала,
	|	ИнвентаризационнаяОпись.ДатаОкончания,
	|	ИнвентаризационнаяОпись.ВидЦены,
	|	ИнвентаризационнаяОпись.Склад,
	|	ИнвентаризационнаяОпись.ИсточникИнформацииОЦенахДляПечати,
	|	ИнвентаризационнаяОпись.Организация,
	|	РасчетСебестоимостиТоваровОрганизации.Ссылка.ПредварительныйРасчет КАК ПредварительныйРасчет
	|ИЗ
	|	Документ.ИнвентаризационнаяОпись КАК ИнвентаризационнаяОпись
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РасчетСебестоимостиТоваров.Организации КАК РасчетСебестоимостиТоваровОрганизации
	|		ПО (РасчетСебестоимостиТоваровОрганизации.Организация = ИнвентаризационнаяОпись.Организация)
	|			И (РасчетСебестоимостиТоваровОрганизации.Ссылка.Проведен)
	|			И (РасчетСебестоимостиТоваровОрганизации.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(ИнвентаризационнаяОпись.ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(ИнвентаризационнаяОпись.ДатаОкончания, МЕСЯЦ))
	|ГДЕ
	|	ИнвентаризационнаяОпись.Ссылка = &ДокументОснование
	|
	|УПОРЯДОЧИТЬ ПО
	|	РасчетСебестоимостиТоваровОрганизации.Ссылка.Дата УБЫВ";

	ЗапросПредварительныхДанных.УстановитьПараметр("ДокументОснование", ДокументОснование);	
	ПредварительныеДанныеРезультат = ЗапросПредварительныхДанных.Выполнить().Выбрать();

	Если НЕ ПредварительныеДанныеРезультат.Следующий() Тогда
		СтруктураВозврата.ОписаниеОшибки = "НетИнвентаризацийВПериоде";
		Возврат СтруктураВозврата;
	КонецЕсли;

	ПредварительныйРасчет 			  = ПредварительныеДанныеРезультат.ПредварительныйРасчет;
	ИсточникИнформацииОЦенахДляПечати = ПредварительныеДанныеРезультат.ИсточникИнформацииОЦенахДляПечати;
	ДатаНачала 						  = ПредварительныеДанныеРезультат.ДатаНачала;
	ДатаОкончания 					  = КонецДня(ПредварительныеДанныеРезультат.ДатаОкончания);
	Склад							  = ПредварительныеДанныеРезультат.Склад;	
	Организация 					  = ПредварительныеДанныеРезультат.Организация;
	ВидЦены 						  = ПредварительныеДанныеРезультат.ВидЦены;

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ДатаНачала", 	   ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания", 	   ДатаОкончания);
	Запрос.УстановитьПараметр("Склад", 			   Склад);
	Запрос.УстановитьПараметр("ДатаОстатков", 	   ДатаОкончания + 1);
	Запрос.УстановитьПараметр("ДокументОснование", ДокументОснование);
	Запрос.УстановитьПараметр("Организация", 	   Организация);
	Запрос.УстановитьПараметр("ВидЦены", 		   ВидЦены);

	// Ответственные лица в печатной форме
	СтруктураОтветственных = ОтветственныеЛицаСервер.ПолучитьОтветственныеЛицаОрганизации(Организация, КонецДня(ДатаОкончания));
	Запрос.УстановитьПараметр("Руководитель", 		   СтруктураОтветственных.Руководитель);
	Запрос.УстановитьПараметр("ДолжностьРуководителя", СтруктураОтветственных.РуководительДолжность);
	Запрос.УстановитьПараметр("ГлавныйБухгалтер", 	   СтруктураОтветственных.ГлавныйБухгалтер);

	Если ИсточникИнформацииОЦенахДляПечати = Перечисления.ИсточникиИнформацииОЦенахДляПечати.ПоСебестоимости Тогда

		Если ПредварительныйРасчет = Null Тогда
			СтруктураВозврата.ОписаниеОшибки = "НетЦенПоСебестоимости";
			СтруктураВозврата.РезультатПоШапке = Новый Структура("ДатаНачала, ДатаОкончания", ДатаНачала, ДатаОкончания);
			Возврат СтруктураВозврата;
		КонецЕсли;

		Если ПредварительныйРасчет Тогда

			СтруктураВозврата.ПоПредварительномуРасчету = Истина;

			ТекстЗапроса =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВложенныйЗапрос.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ВложенныйЗапрос.Организация КАК Организация
			|ПОМЕСТИТЬ ТаблицаНоменклатуры
			|ИЗ
			|	(ВЫБРАТЬ
			|		Аналитика.КлючАналитики КАК АналитикаУчетаНоменклатуры,
			|		&Организация КАК Организация
			|	ИЗ
			|		Документ.ПересчетТоваров.Товары КАК ПересчетТоваровТовары
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
			|			ПО ПересчетТоваровТовары.Номенклатура = Аналитика.Номенклатура
			|				И ПересчетТоваровТовары.Характеристика = Аналитика.Характеристика
			//++ НЕ УТ
			|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
			//-- НЕ УТ
			|				И ПересчетТоваровТовары.Назначение = Аналитика.Назначение
			|				И (ПересчетТоваровТовары.Серия = Аналитика.Серия
			|					ИЛИ НЕ ПересчетТоваровТовары.СтатусУказанияСерий = 14)
			|				И ПересчетТоваровТовары.Ссылка.Склад = Аналитика.МестоХранения
			|	ГДЕ
			|		ПересчетТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересчетТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересчетТоваровТовары.Ссылка.Проведен
			|		И ПересчетТоваровТовары.Ссылка.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПересчетовТоваров.Выполнено)
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		СписаниеНедостачТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.СписаниеНедостачТоваров.Товары КАК СписаниеНедостачТоваровТовары
			|	ГДЕ
			|		СписаниеНедостачТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И СписаниеНедостачТоваровТовары.Ссылка.Склад = &Склад
			|		И СписаниеНедостачТоваровТовары.Ссылка.Проведен
			|		И СписаниеНедостачТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОприходованиеИзлишковТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ОприходованиеИзлишковТоваров.Товары КАК ОприходованиеИзлишковТоваровТовары
			|	ГДЕ
			|		ОприходованиеИзлишковТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Склад = &Склад
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Проведен
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
			|	ГДЕ
			|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересортицаТоваровТовары.Ссылка.Проведен
			|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатурыОприходование,
			|		&Организация
			|	ИЗ
			|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
			|	ГДЕ
			|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересортицаТоваровТовары.Ссылка.Проведен
			|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПорчаТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТовары
			|	ГДЕ
			|		ПорчаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПорчаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПорчаТоваровТовары.Ссылка.Проведен
			|		И ПорчаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Аналитика.КлючАналитики,
			|		&Организация
			|	ИЗ
			|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТоварыОприходованные
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
			|			ПО ПорчаТоваровТоварыОприходованные.НоменклатураОприходование = Аналитика.Номенклатура
			|				И ПорчаТоваровТоварыОприходованные.ХарактеристикаОприходование = Аналитика.Характеристика
			|				И ПорчаТоваровТоварыОприходованные.Назначение = Аналитика.Назначение
			//++ НЕ УТ
			|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
			//-- НЕ УТ
			|				И (ПорчаТоваровТоварыОприходованные.Серия = Аналитика.Серия
			|					ИЛИ НЕ ПорчаТоваровТоварыОприходованные.СтатусУказанияСерий = 14)
			|				И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = Аналитика.МестоХранения
			|	ГДЕ
			|		ПорчаТоваровТоварыОприходованные.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = &Склад
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Проведен
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Организация = &Организация) КАК ВложенныйЗапрос
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизацийОстатки.ВидЗапасов,
//#Вставка
			|	ТоварыОрганизацийОстатки.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
			|	ТоварыОрганизацийОстатки.КоличествоОстаток
			|ПОМЕСТИТЬ ТоварыОрганизацийОстатки
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций.Остатки(
			|			&ДатаОстатков,
			|			АналитикаУчетаНоменклатуры В
			|					(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|						ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры
			|					ИЗ
			|						ТаблицаНоменклатуры)
			|				И Организация = &Организация
//#Удаление			
//			|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар))) КАК ТоварыОрганизацийОстатки
//#КонецУдаления
//#Вставка
			|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))) КАК ТоварыОрганизацийОстатки
//#КонецВставки			
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов КАК ВидЗапасов,
			|	-ТоварыОрганизаций.Количество КАК КоличествоОтклонение,
			|	0 КАК КоличествоФактическое
			|ПОМЕСТИТЬ ТоварыИнвентаризации
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.СписаниеНедостачТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ТоварыОрганизаций.Количество,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ОприходованиеИзлишковТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ВЫБОР
			|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|			ТОГДА ТоварыОрганизаций.Количество
			|		ИНАЧЕ -ТоварыОрганизаций.Количество
			|	КОНЕЦ,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПересортицаТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ВЫБОР
			|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|			ТОГДА ТоварыОрганизаций.Количество
			|		ИНАЧЕ -ТоварыОрганизаций.Количество
			|	КОНЕЦ,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПорчаТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизацийОстатки.ВидЗапасов,
			|	0,
			|	ТоварыОрганизацийОстатки.КоличествоОстаток
			|ИЗ
			|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТоварыОрганизацийОстатки КАК ТоварыОрганизацийОстатки
			|		ПО ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры = ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТоварыИнвентаризации.ВидЗапасов КАК ВидЗапасов,
//#Вставка
			|	ТоварыИнвентаризации.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
			|	&Организация КАК Организация,
			|	СУММА(ТоварыИнвентаризации.КоличествоФактическое) КАК КоличествоФактическое,
			|	СУММА(ТоварыИнвентаризации.КоличествоФактическое - ТоварыИнвентаризации.КоличествоОтклонение) КАК КоличествоПоУчету
			|ПОМЕСТИТЬ ТаблицаИнвентаризации
			|ИЗ
			|	ТоварыИнвентаризации КАК ТоварыИнвентаризации
			|
			|СГРУППИРОВАТЬ ПО
			|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры,
			|	ТоварыИнвентаризации.ВидЗапасов
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	&Руководитель КАК Руководитель,
			|	&ДолжностьРуководителя КАК ДолжностьРуководителя,
			|	&ГлавныйБухгалтер КАК ГлавныйБухгалтер,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).НаименованиеСокращенное КАК ОрганизацияПредставление,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).КодПоОКПО КАК ОрганизацияПоОКПО,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).Префикс КАК Префикс,
			|	ИнвентаризационнаяОпись.Склад.ТекущийОтветственный КАК Кладовщик,
			|	ИнвентаризационнаяОпись.Склад.ТекущаяДолжностьОтветственного КАК ДолжностьКладовщика,
			|	ИнвентаризационнаяОпись.Склад.Наименование КАК ПодразделениеПредставление,
			|	&ДатаНачала КАК ДатаНачала,
			|	&ДатаОкончания КАК ДатаОкончания,
			|	ИнвентаризационнаяОпись.Склад КАК Склад,
			|	ИнвентаризационнаяОпись.Дата КАК ОснованиеДата,
			|	ИнвентаризационнаяОпись.Номер КАК ОснованиеНомер,
			|	ИнвентаризационнаяОпись.Номер КАК НомерДокумента,
			|	ИнвентаризационнаяОпись.Дата КАК ДатаДокумента,
			|	ИнвентаризационнаяОпись.Ссылка КАК Ссылка,
			|	&ДатаОкончания КАК ДатаСнятияОстатков
			|ИЗ
			|	Документ.ИнвентаризационнаяОпись КАК ИнвентаризационнаяОпись
			|ГДЕ
			|	ИнвентаризационнаяОпись.Ссылка = &ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЦеныНоменклатуры.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ЦеныНоменклатуры.ВидЗапасов КАК ВидЗапасов,
			|	ЦеныНоменклатуры.Организация КАК Организация,
			|	(ЦеныНоменклатуры.СтоимостьРегл
			|		+ ЦеныНоменклатуры.ДопРасходыРегл
			|		+ ЦеныНоменклатуры.ТрудозатратыРегл
			|		+ ЦеныНоменклатуры.ПостатейныеПостоянныеРегл
			|		+ ЦеныНоменклатуры.ПостатейныеПеременныеРегл) КАК СтоимостьРегл
			|ПОМЕСТИТЬ ЦеныНоменклатуры
			|ИЗ
			|	РегистрСведений.СтоимостьТоваров.СрезПоследних(
			|			&ДатаОкончания,
			|			(АналитикаУчетаНоменклатуры, ВидЗапасов, РазделУчета, Организация) В
			|				(ВЫБРАТЬ
			|					Таблица.АналитикаУчетаНоменклатуры,
			|					Таблица.ВидЗапасов,
			|					ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
			|					Таблица.Организация
			|				ИЗ
			|					ТаблицаИнвентаризации КАК Таблица)) КАК ЦеныНоменклатуры
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия КАК Серия,
//#Вставка
			|	ТаблицаИнвентаризации.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.НаименованиеПолное КАК ТоварНаименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика.НаименованиеПолное КАК ХарактеристикаНаименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия.Наименование КАК СерияНаименование,
			|	СУММА(ТаблицаИнвентаризации.КоличествоПоУчету) КАК КоличествоПоУчету,
			|	СУММА(ТаблицаИнвентаризации.КоличествоФактическое) КАК КоличествоФактическое,
			|	ЕСТЬNULL(ЦеныНоменклатуры.СтоимостьРегл, 0) КАК Цена,
			|	СУММА(ТаблицаИнвентаризации.КоличествоПоУчету * ЕСТЬNULL(ЦеныНоменклатуры.СтоимостьРегл, 0)) КАК СуммаПоУчету,
			|	СУММА(ТаблицаИнвентаризации.КоличествоФактическое * ЕСТЬNULL(ЦеныНоменклатуры.СтоимостьРегл, 0)) КАК СуммаФактическая,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.Код КАК ТоварКод,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код КАК ЕдиницаИзмеренияКод,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Наименование КАК ЕдиницаИзмеренияНаименование,
			|	ЛОЖЬ КАК ЭтоВозвратнаяТара
			|ИЗ
			|	ТаблицаИнвентаризации КАК ТаблицаИнвентаризации
			|		ЛЕВОЕ СОЕДИНЕНИЕ ЦеныНоменклатуры КАК ЦеныНоменклатуры
			|		ПО ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры = ЦеныНоменклатуры.АналитикаУчетаНоменклатуры
			|			И ТаблицаИнвентаризации.ВидЗапасов = ЦеныНоменклатуры.ВидЗапасов
			|			И (ЦеныНоменклатуры.Организация = &Организация)
			|
			|СГРУППИРОВАТЬ ПО
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика.НаименованиеПолное,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия.Наименование,
//#Вставка
			|	ТаблицаИнвентаризации.ТипЗапасов,
//#КонецВставки			
			|	ЕСТЬNULL(ЦеныНоменклатуры.СтоимостьРегл, 0),
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Наименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.НаименованиеПолное,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.Код,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия
			|
			|УПОРЯДОЧИТЬ ПО
			|	ТоварНаименование,
			|	Номенклатура";

			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Номенклатура.Код", "Номенклатура." + КолонкаКодов);

			Запрос.Текст = ТекстЗапроса;

			Результаты = Запрос.ВыполнитьПакет();
			РезультатПоШапке = Результаты[4];
			РезультатПоТабличнойЧасти = Результаты[6];
			РезультатКурсВалюты = Неопределено;

		Иначе
			// фактический расчет

			ТекстЗапроса =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВложенныйЗапрос.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ВложенныйЗапрос.Организация КАК Организация1
			|ПОМЕСТИТЬ ТаблицаНоменклатуры
			|ИЗ
			|	(ВЫБРАТЬ
			|		Аналитика.КлючАналитики КАК АналитикаУчетаНоменклатуры,
			|		&Организация КАК Организация
			|	ИЗ
			|		Документ.ПересчетТоваров.Товары КАК ПересчетТоваровТовары
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
			|			ПО ПересчетТоваровТовары.Номенклатура = Аналитика.Номенклатура
			|				И ПересчетТоваровТовары.Характеристика = Аналитика.Характеристика
			|				И ПересчетТоваровТовары.Назначение = Аналитика.Назначение
			//++ НЕ УТ
			|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
			//-- НЕ УТ
			|				И (ПересчетТоваровТовары.Серия = Аналитика.Серия
			|					ИЛИ НЕ ПересчетТоваровТовары.СтатусУказанияСерий = 14)
			|				И ПересчетТоваровТовары.Ссылка.Склад = Аналитика.МестоХранения
			|	ГДЕ
			|		ПересчетТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересчетТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересчетТоваровТовары.Ссылка.Проведен
			|		И ПересчетТоваровТовары.Ссылка.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПересчетовТоваров.Выполнено)
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		СписаниеНедостачТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.СписаниеНедостачТоваров.Товары КАК СписаниеНедостачТоваровТовары
			|	ГДЕ
			|		СписаниеНедостачТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И СписаниеНедостачТоваровТовары.Ссылка.Склад = &Склад
			|		И СписаниеНедостачТоваровТовары.Ссылка.Проведен
			|		И СписаниеНедостачТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ОприходованиеИзлишковТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ОприходованиеИзлишковТоваров.Товары КАК ОприходованиеИзлишковТоваровТовары
			|	ГДЕ
			|		ОприходованиеИзлишковТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Склад = &Склад
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Проведен
			|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
			|	ГДЕ
			|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересортицаТоваровТовары.Ссылка.Проведен
			|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатурыОприходование,
			|		&Организация
			|	ИЗ
			|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
			|	ГДЕ
			|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПересортицаТоваровТовары.Ссылка.Проведен
			|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПорчаТоваровТовары.АналитикаУчетаНоменклатуры,
			|		&Организация
			|	ИЗ
			|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТовары
			|	ГДЕ
			|		ПорчаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПорчаТоваровТовары.Ссылка.Склад = &Склад
			|		И ПорчаТоваровТовары.Ссылка.Проведен
			|		И ПорчаТоваровТовары.Ссылка.Организация = &Организация
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Аналитика.КлючАналитики,
			|		&Организация
			|	ИЗ
			|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТоварыОприходованные
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
			|			ПО ПорчаТоваровТоварыОприходованные.НоменклатураОприходование = Аналитика.Номенклатура
			|				И ПорчаТоваровТоварыОприходованные.ХарактеристикаОприходование = Аналитика.Характеристика
			//++ НЕ УТ
			|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
			//-- НЕ УТ
			|				И ПорчаТоваровТоварыОприходованные.Назначение = Аналитика.Назначение
			|				И (ПорчаТоваровТоварыОприходованные.Серия = Аналитика.Серия
			|					ИЛИ НЕ ПорчаТоваровТоварыОприходованные.СтатусУказанияСерий = 14)
			|				И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = Аналитика.МестоХранения
			|	ГДЕ
			|		ПорчаТоваровТоварыОприходованные.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = &Склад
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Проведен
			|		И ПорчаТоваровТоварыОприходованные.Ссылка.Организация = &Организация) КАК ВложенныйЗапрос
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизацийОстатки.ВидЗапасов,
			|	ТоварыОрганизацийОстатки.КоличествоОстаток
			|ПОМЕСТИТЬ ТоварыОрганизацийОстатки
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций.Остатки(
			|			&ДатаОстатков,
			|			АналитикаУчетаНоменклатуры В
			|					(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|						ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры
			|					ИЗ
			|						ТаблицаНоменклатуры)
			|				И Организация = &Организация
//#Удаление			
//			|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар))) КАК ТоварыОрганизацийОстатки
//#КонецУдаления
//#Вставка
			|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))) КАК ТоварыОрганизацийОстатки
//#КонецВставки			
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов КАК ВидЗапасов,
			|	-ТоварыОрганизаций.Количество КАК КоличествоОтклонение,
			|	0 КАК КоличествоФактическое
			|ПОМЕСТИТЬ ТоварыИнвентаризации
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.СписаниеНедостачТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ТоварыОрганизаций.Количество,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ОприходованиеИзлишковТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ВЫБОР
			|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|			ТОГДА ТоварыОрганизаций.Количество
			|		ИНАЧЕ -ТоварыОрганизаций.Количество
			|	КОНЕЦ,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПересортицаТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизаций.ВидЗапасов,
			|	ВЫБОР
			|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|			ТОГДА ТоварыОрганизаций.Количество
			|		ИНАЧЕ -ТоварыОрганизаций.Количество
			|	КОНЕЦ,
			|	0
			|ИЗ
			|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
			|ГДЕ
			|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПорчаТоваров
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Склад = &Склад
			|	И ТоварыОрганизаций.Организация = &Организация
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры,
			|	ТоварыОрганизацийОстатки.ВидЗапасов,
			|	0,
			|	ТоварыОрганизацийОстатки.КоличествоОстаток
			|ИЗ
			|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТоварыОрганизацийОстатки КАК ТоварыОрганизацийОстатки
			|		ПО ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры = ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ТоварыКОформлениюОтчетовКомитенту.ВидЗапасов КАК ВидЗапасов,
			|	ТоварыКОформлениюОтчетовКомитенту.КорВидЗапасов КАК НовыйВидЗапасов,
			|	ТоварыКОформлениюОтчетовКомитенту.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры
			|ПОМЕСТИТЬ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров
			|ИЗ
			|	ТоварыИнвентаризации КАК ТоварыИнвентаризации
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОформлениюОтчетовКомитенту КАК ТоварыКОформлениюОтчетовКомитенту
			|		ПО (ТоварыКОформлениюОтчетовКомитенту.ВидЗапасов = ТоварыИнвентаризации.ВидЗапасов)
			|			И (ТоварыКОформлениюОтчетовКомитенту.АналитикаУчетаНоменклатуры.Номенклатура = ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура)
			|			И (ТоварыКОформлениюОтчетовКомитенту.АналитикаУчетаНоменклатуры.Характеристика = ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика)
			|			И ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Серия = ТоварыКОформлениюОтчетовКомитенту.АналитикаУчетаНоменклатуры.Серия
			|ГДЕ
			|	ТоварыИнвентаризации.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТОвар)
			|	И ТоварыКОформлениюОтчетовКомитенту.КорВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.АналитикаУчетаНоменклатуры
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.АналитикаУчетаНоменклатуры
			|	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.ВидЗапасов
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.НовыйВидЗапасов
			|	КОНЕЦ КАК ВидЗапасов,
//#Вставка
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.ВидЗапасов.ТипЗапасов
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.НовыйВидЗапасов.ТипЗапасов
			|	КОНЕЦ КАК ТипЗапасов,
//#КонецВставки			
			|	&Организация КАК Организация,
			|	СУММА(ТоварыИнвентаризации.КоличествоФактическое) КАК КоличествоФактическое,
			|	СУММА(ТоварыИнвентаризации.КоличествоФактическое - ТоварыИнвентаризации.КоличествоОтклонение) КАК КоличествоПоУчету
			|ПОМЕСТИТЬ ТаблицаИнвентаризации
			|ИЗ
			|	ТоварыИнвентаризации КАК ТоварыИнвентаризации
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров КАК ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров
			|		ПО (ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов = ТоварыИнвентаризации.ВидЗапасов)
			|			И (ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.АналитикаУчетаНоменклатуры.Номенклатура = ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура)
			|			И (ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.АналитикаУчетаНоменклатуры.Характеристика = ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика)
			|			И (ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.АналитикаУчетаНоменклатуры.Серия = ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Серия)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.АналитикаУчетаНоменклатуры
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.АналитикаУчетаНоменклатуры
			|	КОНЕЦ,
//#Вставка
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.ВидЗапасов.ТипЗапасов
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.НовыйВидЗапасов.ТипЗапасов
			|	КОНЕЦ,
//#КонецВставки			
			|	ВЫБОР
			|		КОГДА ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.ВидЗапасов ЕСТЬ NULL 
			|			ТОГДА ТоварыИнвентаризации.ВидЗапасов
			|		ИНАЧЕ ВидыЗапасовИАналитикиУчетаНоменклатурыКомиссионныхТоваров.НовыйВидЗапасов
			|	КОНЕЦ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СебестоимостьТоваровОстатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	СебестоимостьТоваровОстатки.ВидЗапасов КАК ВидЗапасов,
			|	СебестоимостьТоваровОстатки.Организация КАК Организация,
			|	ВЫБОР
			|		КОГДА СебестоимостьТоваровОстатки.КоличествоОстаток = 0
			|			ТОГДА 0
			|		ИНАЧЕ (СебестоимостьТоваровОстатки.СтоимостьРеглОстаток
			|				+ СебестоимостьТоваровОстатки.ДопРасходыРеглОстаток
			|				+ СебестоимостьТоваровОстатки.ТрудозатратыРеглОстаток
			|				+ СебестоимостьТоваровОстатки.ПостатейныеПостоянныеРеглОстаток
			|				+ СебестоимостьТоваровОстатки.ПостатейныеПеременныеРеглОстаток)
			|			/ СебестоимостьТоваровОстатки.КоличествоОстаток
			|	КОНЕЦ КАК Цена
			|ПОМЕСТИТЬ СебестоимостьТоваровОстатки
			|ИЗ
			|	РегистрНакопления.СебестоимостьТоваров.Остатки(
			|			&ДатаОстатков,
			|			(АналитикаУчетаНоменклатуры, ВидЗапасов, Организация) В
			|				(ВЫБРАТЬ
			|					Таблица.АналитикаУчетаНоменклатуры,
			|					Таблица.ВидЗапасов,
			|					Таблица.Организация
			|				ИЗ
			|					ТаблицаИнвентаризации КАК Таблица)) КАК СебестоимостьТоваровОстатки
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СтоимостьТоваровСрезПоследних.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	СтоимостьТоваровСрезПоследних.ВидЗапасов КАК ВидЗапасов,
			|	СтоимостьТоваровСрезПоследних.Организация КАК Организация,
			|	(СтоимостьТоваровСрезПоследних.СтоимостьРегл
			|		+ СтоимостьТоваровСрезПоследних.ДопРасходыРегл
			|		+ СтоимостьТоваровСрезПоследних.ТрудозатратыРегл
			|		+ СтоимостьТоваровСрезПоследних.ПостатейныеПостоянныеРегл
			|		+ СтоимостьТоваровСрезПоследних.ПостатейныеПеременныеРегл) КАК Цена
			|ПОМЕСТИТЬ СтоимостьТоваровСрезПоследних
			|ИЗ
			|	РегистрСведений.СтоимостьТоваров.СрезПоследних(
			|			&ДатаОкончания,
			|			(АналитикаУчетаНоменклатуры, ВидЗапасов, РазделУчета, Организация) В
			|				(ВЫБРАТЬ
			|					Таблица.АналитикаУчетаНоменклатуры,
			|					Таблица.ВидЗапасов,
			|					ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
			|					Таблица.Организация
			|				ИЗ
			|					ТаблицаИнвентаризации КАК Таблица)) КАК СтоимостьТоваровСрезПоследних
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
			|	ТаблицаИнвентаризации.ВидЗапасов КАК ВидЗапасов,
			|	ВЫБОР
			|		КОГДА ЕСТЬNULL(СебестоимостьТоваровОстатки.Цена, 0) = 0
			|			ТОГДА ЕСТЬNULL(СтоимостьТоваровСрезПоследних.Цена, 0)
			|		ИНАЧЕ СебестоимостьТоваровОстатки.Цена
			|	КОНЕЦ КАК Цена
			|ПОМЕСТИТЬ ТаблицаЦен
			|ИЗ
			|	ТаблицаИнвентаризации КАК ТаблицаИнвентаризации
			|		ЛЕВОЕ СОЕДИНЕНИЕ СебестоимостьТоваровОстатки КАК СебестоимостьТоваровОстатки
			|		ПО ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры = СебестоимостьТоваровОстатки.АналитикаУчетаНоменклатуры
			|			И ТаблицаИнвентаризации.ВидЗапасов = СебестоимостьТоваровОстатки.ВидЗапасов
			|			И (СебестоимостьТоваровОстатки.Организация = &Организация)
			|		ЛЕВОЕ СОЕДИНЕНИЕ СтоимостьТоваровСрезПоследних КАК СтоимостьТоваровСрезПоследних
			|		ПО ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры = СтоимостьТоваровСрезПоследних.АналитикаУчетаНоменклатуры
			|			И ТаблицаИнвентаризации.ВидЗапасов = СтоимостьТоваровСрезПоследних.ВидЗапасов
			|			И (СтоимостьТоваровСрезПоследних.Организация = &Организация)
			|
			|СГРУППИРОВАТЬ ПО
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры,
			|	ВЫБОР
			|		КОГДА ЕСТЬNULL(СебестоимостьТоваровОстатки.Цена, 0) = 0
			|			ТОГДА ЕСТЬNULL(СтоимостьТоваровСрезПоследних.Цена, 0)
			|		ИНАЧЕ СебестоимостьТоваровОстатки.Цена
			|	КОНЕЦ,
			|	ТаблицаИнвентаризации.ВидЗапасов
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	&Руководитель КАК Руководитель,
			|	&ДолжностьРуководителя КАК ДолжностьРуководителя,
			|	&ГлавныйБухгалтер КАК ГлавныйБухгалтер,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).НаименованиеСокращенное КАК ОрганизацияПредставление,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).КодПоОКПО КАК ОрганизацияПоОКПО,
			|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).Префикс КАК Префикс,
			|	ИнвентаризационнаяОпись.Склад.ТекущийОтветственный КАК Кладовщик,
			|	ИнвентаризационнаяОпись.Склад.ТекущаяДолжностьОтветственного КАК ДолжностьКладовщика,
			|	ИнвентаризационнаяОпись.Склад.Наименование КАК ПодразделениеПредставление,
			|	&ДатаНачала КАК ДатаНачала,
			|	&ДатаОкончания КАК ДатаОкончания,
			|	ИнвентаризационнаяОпись.Склад КАК Склад,
			|	ИнвентаризационнаяОпись.Дата КАК ОснованиеДата,
			|	ИнвентаризационнаяОпись.Номер КАК ОснованиеНомер,
			|	ИнвентаризационнаяОпись.Номер КАК НомерДокумента,
			|	ИнвентаризационнаяОпись.Дата КАК ДатаДокумента,
			|	ИнвентаризационнаяОпись.Ссылка КАК Ссылка,
			|	&ДатаОкончания КАК ДатаСнятияОстатков
			|ИЗ
			|	Документ.ИнвентаризационнаяОпись КАК ИнвентаризационнаяОпись
			|ГДЕ
			|	ИнвентаризационнаяОпись.Ссылка = &ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия КАК Серия,
//#Вставка
			|	ТаблицаИнвентаризации.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.НаименованиеПолное КАК ТоварНаименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика.НаименованиеПолное КАК ХарактеристикаНаименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия.Наименование КАК СерияНаименование,
			|	СУММА(ТаблицаИнвентаризации.КоличествоПоУчету) КАК КоличествоПоУчету,
			|	СУММА(ТаблицаИнвентаризации.КоличествоФактическое) КАК КоличествоФактическое,
			|	ТаблицаЦен.Цена КАК Цена,
			|	СУММА(ТаблицаИнвентаризации.КоличествоПоУчету * ТаблицаЦен.Цена) КАК СуммаПоУчету,
			|	СУММА(ТаблицаИнвентаризации.КоличествоФактическое * ТаблицаЦен.Цена) КАК СуммаФактическая,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код КАК ЕдиницаИзмеренияКод,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Наименование КАК ЕдиницаИзмеренияНаименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.Код КАК ТоварКод,
			|	ЛОЖЬ КАК ЭтоВозвратнаяТара
			|ИЗ
			|	ТаблицаИнвентаризации КАК ТаблицаИнвентаризации
			|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаЦен КАК ТаблицаЦен
			|		ПО ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры = ТаблицаЦен.АналитикаУчетаНоменклатуры
			|			И ТаблицаИнвентаризации.ВидЗапасов = ТаблицаЦен.ВидЗапасов
			|
			|СГРУППИРОВАТЬ ПО
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика.НаименованиеПолное,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия.Наименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Код,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.ЕдиницаИзмерения.Наименование,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.НаименованиеПолное,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура.Код,
			|	ТаблицаЦен.Цена,
//#Вставка
			|	ТаблицаИнвентаризации.ТипЗапасов,
//#КонецВставки			
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика,
			|	ТаблицаИнвентаризации.АналитикаУчетаНоменклатуры.Серия
			|
			|УПОРЯДОЧИТЬ ПО
			|	ТоварНаименование,
			|	Номенклатура";

			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Номенклатура.Код", "Номенклатура." + КолонкаКодов);

			Запрос.Текст = ТекстЗапроса;

			Результаты = Запрос.ВыполнитьПакет();
			РезультатПоШапке = Результаты[8];
			РезультатПоТабличнойЧасти = Результаты[9];
			РезультатКурсВалюты = Неопределено;

		КонецЕсли;		

	ИначеЕсли ИсточникИнформацииОЦенахДляПечати = Перечисления.ИсточникиИнформацииОЦенахДляПечати.ПоВидуЦен Тогда 

		ТекстЗапроса =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВложенныйЗапрос.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ВложенныйЗапрос.Организация КАК Организация1
		|ПОМЕСТИТЬ ТаблицаНоменклатуры
		|ИЗ
		|	(ВЫБРАТЬ
		|		Аналитика.КлючАналитики КАК АналитикаУчетаНоменклатуры,
		|		&Организация КАК Организация
		|	ИЗ
		|		Документ.ПересчетТоваров.Товары КАК ПересчетТоваровТовары
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
		|			ПО ПересчетТоваровТовары.Номенклатура = Аналитика.Номенклатура
		|				И ПересчетТоваровТовары.Характеристика = Аналитика.Характеристика
		|				И ПересчетТоваровТовары.Назначение = Аналитика.Назначение
		//++ НЕ УТ
		|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
		//-- НЕ УТ
		|				И (ПересчетТоваровТовары.Серия = Аналитика.Серия
		|					ИЛИ НЕ ПересчетТоваровТовары.СтатусУказанияСерий = 14)
		|				И ПересчетТоваровТовары.Ссылка.Склад = Аналитика.МестоХранения
		|	ГДЕ
		|		ПересчетТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ПересчетТоваровТовары.Ссылка.Склад = &Склад
		|		И ПересчетТоваровТовары.Ссылка.Проведен
		|		И ПересчетТоваровТовары.Ссылка.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПересчетовТоваров.Выполнено)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СписаниеНедостачТоваровТовары.АналитикаУчетаНоменклатуры,
		|		&Организация
		|	ИЗ
		|		Документ.СписаниеНедостачТоваров.Товары КАК СписаниеНедостачТоваровТовары
		|	ГДЕ
		|		СписаниеНедостачТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И СписаниеНедостачТоваровТовары.Ссылка.Склад = &Склад
		|		И СписаниеНедостачТоваровТовары.Ссылка.Проведен
		|		И СписаниеНедостачТоваровТовары.Ссылка.Организация = &Организация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ОприходованиеИзлишковТоваровТовары.АналитикаУчетаНоменклатуры,
		|		&Организация
		|	ИЗ
		|		Документ.ОприходованиеИзлишковТоваров.Товары КАК ОприходованиеИзлишковТоваровТовары
		|	ГДЕ
		|		ОприходованиеИзлишковТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Склад = &Склад
		|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Проведен
		|		И ОприходованиеИзлишковТоваровТовары.Ссылка.Организация = &Организация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатуры,
		|		&Организация
		|	ИЗ
		|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
		|	ГДЕ
		|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
		|		И ПересортицаТоваровТовары.Ссылка.Проведен
		|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ПересортицаТоваровТовары.АналитикаУчетаНоменклатурыОприходование,
		|		&Организация
		|	ИЗ
		|		Документ.ПересортицаТоваров.Товары КАК ПересортицаТоваровТовары
		|	ГДЕ
		|		ПересортицаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ПересортицаТоваровТовары.Ссылка.Склад = &Склад
		|		И ПересортицаТоваровТовары.Ссылка.Проведен
		|		И ПересортицаТоваровТовары.Ссылка.Организация = &Организация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ПорчаТоваровТовары.АналитикаУчетаНоменклатуры,
		|		&Организация
		|	ИЗ
		|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТовары
		|	ГДЕ
		|		ПорчаТоваровТовары.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ПорчаТоваровТовары.Ссылка.Склад = &Склад
		|		И ПорчаТоваровТовары.Ссылка.Проведен
		|		И ПорчаТоваровТовары.Ссылка.Организация = &Организация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Аналитика.КлючАналитики,
		|		&Организация
		|	ИЗ
		|		Документ.ПорчаТоваров.Товары КАК ПорчаТоваровТоварыОприходованные
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
		|			ПО ПорчаТоваровТоварыОприходованные.НоменклатураОприходование = Аналитика.Номенклатура
		//++ НЕ УТ
		|				И (ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = Аналитика.СтатьяКалькуляции)
		//-- НЕ УТ
		|				И ПорчаТоваровТоварыОприходованные.ХарактеристикаОприходование = Аналитика.Характеристика
		|				И ПорчаТоваровТоварыОприходованные.Назначение = Аналитика.Назначение
		|				И (ПорчаТоваровТоварыОприходованные.Серия = Аналитика.Серия
		|					ИЛИ НЕ ПорчаТоваровТоварыОприходованные.СтатусУказанияСерий = 14)
		|				И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = Аналитика.МестоХранения
		|	ГДЕ
		|		ПорчаТоваровТоварыОприходованные.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|		И ПорчаТоваровТоварыОприходованные.Ссылка.Склад = &Склад
		|		И ПорчаТоваровТоварыОприходованные.Ссылка.Проведен
		|		И ПорчаТоваровТоварыОприходованные.Ссылка.Организация = &Организация) КАК ВложенныйЗапрос
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизацийОстатки.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	ТоварыОрганизацийОстатки.КоличествоОстаток
		|ПОМЕСТИТЬ ТоварыОрганизацийОстатки
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизаций.Остатки(
		|			&ДатаОстатков,
		|			АналитикаУчетаНоменклатуры В
		|					(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|						ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры
		|					ИЗ
		|						ТаблицаНоменклатуры)
		|				И Организация = &Организация
//#Удаление			
//		|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар))) КАК ТоварыОрганизацийОстатки
//#КонецУдаления
//#Вставка
		|				И ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))) КАК ТоварыОрганизацийОстатки
//#КонецВставки			
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизаций.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		
		|	-ТоварыОрганизаций.Количество КАК КоличествоОтклонение,
		|	0 КАК КоличествоФактическое
		|ПОМЕСТИТЬ ТоварыИнвентаризации
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|ГДЕ
		|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.СписаниеНедостачТоваров
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.СписаниеНедостачТоваров).Склад = &Склад
		|	И ТоварыОрганизаций.Организация = &Организация
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизаций.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	ТоварыОрганизаций.Количество,
		|	0
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|ГДЕ
		|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ОприходованиеИзлишковТоваров
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ОприходованиеИзлишковТоваров).Склад = &Склад
		|	И ТоварыОрганизаций.Организация = &Организация
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизаций.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	ВЫБОР
		|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ТоварыОрганизаций.Количество
		|		ИНАЧЕ -ТоварыОрганизаций.Количество
		|	КОНЕЦ,
		|	0
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|ГДЕ
		|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПересортицаТоваров
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПересортицаТоваров).Склад = &Склад
		|	И ТоварыОрганизаций.Организация = &Организация
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ТоварыОрганизаций.АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизаций.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	ВЫБОР
		|		КОГДА ТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ТоварыОрганизаций.Количество
		|		ИНАЧЕ -ТоварыОрганизаций.Количество
		|	КОНЕЦ,
		|	0
		|ИЗ
		|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|ГДЕ
		|	ТоварыОрганизаций.Регистратор ССЫЛКА Документ.ПорчаТоваров
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
		|	И ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ПорчаТоваров).Склад = &Склад
		|	И ТоварыОрганизаций.Организация = &Организация
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры,
//#Вставка
		|	ТоварыОрганизацийОстатки.ВидЗапасов.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	0,
		|	ТоварыОрганизацийОстатки.КоличествоОстаток
		|ИЗ
		|	ТаблицаНоменклатуры КАК ТаблицаНоменклатуры
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТоварыОрганизацийОстатки КАК ТоварыОрганизацийОстатки
		|		ПО ТаблицаНоменклатуры.АналитикаУчетаНоменклатуры = ТоварыОрганизацийОстатки.АналитикаУчетаНоменклатуры
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Серия КАК Серия,
//#Вставка		
		|	ТоварыИнвентаризации.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	СУММА(ТоварыИнвентаризации.КоличествоФактическое) КАК КоличествоФактическое,
		|	СУММА(ТоварыИнвентаризации.КоличествоФактическое - ТоварыИнвентаризации.КоличествоОтклонение) КАК КоличествоПоУчету
		|ПОМЕСТИТЬ ТаблицаИнвентаризации
		|ИЗ
		|	ТоварыИнвентаризации КАК ТоварыИнвентаризации
		|
		|СГРУППИРОВАТЬ ПО
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Характеристика,
//#Вставка		
		|	ТоварыИнвентаризации.ТипЗапасов,
//#КонецВставки
		|	ТоварыИнвентаризации.АналитикаУчетаНоменклатуры.Серия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	&Руководитель КАК Руководитель,
		|	&ДолжностьРуководителя КАК ДолжностьРуководителя,
		|	&ГлавныйБухгалтер КАК ГлавныйБухгалтер,
		|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).НаименованиеСокращенное КАК ОрганизацияПредставление,
		|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).КодПоОКПО КАК ОрганизацияПоОКПО,
		|	ВЫРАЗИТЬ(&Организация КАК Справочник.Организации).Префикс КАК Префикс,
		|	ИнвентаризационнаяОпись.Склад.ТекущийОтветственный КАК Кладовщик,
		|	ИнвентаризационнаяОпись.Склад.ТекущаяДолжностьОтветственного КАК ДолжностьКладовщика,
		|	ИнвентаризационнаяОпись.Склад.Наименование КАК ПодразделениеПредставление,
		|	&ДатаНачала КАК ДатаНачала,
		|	&ДатаОкончания КАК ДатаОкончания,
		|	ИнвентаризационнаяОпись.Склад КАК Склад,
		|	ИнвентаризационнаяОпись.Дата КАК ОснованиеДата,
		|	ИнвентаризационнаяОпись.Номер КАК ОснованиеНомер,
		|	ИнвентаризационнаяОпись.Номер КАК НомерДокумента,
		|	ИнвентаризационнаяОпись.Дата КАК ДатаДокумента,
		|	ИнвентаризационнаяОпись.Ссылка КАК Ссылка,
		|	&ДатаОкончания КАК ДатаСнятияОстатков
		|ИЗ
		|	Документ.ИнвентаризационнаяОпись КАК ИнвентаризационнаяОпись
		|ГДЕ
		|	ИнвентаризационнаяОпись.Ссылка = &ДокументОснование
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЦеныНоменклатуры.Номенклатура КАК Номенклатура,
		|	ЦеныНоменклатуры.Характеристика КАК Характеристика,
		|	ЦеныНоменклатуры.Упаковка,
		|	ЦеныНоменклатуры.Цена
		|ПОМЕСТИТЬ ЦеныНоменклатуры
		|ИЗ
		|	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
		|			&ДатаОкончания,
		|			(ВидЦены, Номенклатура, Характеристика) В
		|				(ВЫБРАТЬ
		|					&ВидЦены,
		|					Таблица.Номенклатура,
		|					Таблица.Характеристика
		|				ИЗ
		|					ТаблицаИнвентаризации КАК Таблица)) КАК ЦеныНоменклатуры
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаИнвентаризации.Номенклатура КАК Номенклатура,
		|	ТаблицаИнвентаризации.Характеристика КАК Характеристика,
		|	ТаблицаИнвентаризации.Серия КАК Серия,
//#Вставка
		|	ТаблицаИнвентаризации.ТипЗапасов КАК ТипЗапасов,
//#КонецВставки			
		|	ТаблицаИнвентаризации.Номенклатура.НаименованиеПолное КАК ТоварНаименование,
		|	ТаблицаИнвентаризации.Характеристика.НаименованиеПолное КАК ХарактеристикаНаименование,
		|	ТаблицаИнвентаризации.Серия.Наименование КАК СерияНаименование,
		|	ТаблицаИнвентаризации.КоличествоПоУчету,
		|	ТаблицаИнвентаризации.КоличествоФактическое,
		|	ВЫБОР
		|		КОГДА НЕ &ТекстЗапросаКоэффициентУпаковки ЕСТЬ NULL 
		|				И &ТекстЗапросаКоэффициентУпаковки <> 0
		|			ТОГДА ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0) / &ТекстЗапросаКоэффициентУпаковки
		|		ИНАЧЕ ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0)
		|	КОНЕЦ КАК Цена,
		|	ТаблицаИнвентаризации.КоличествоПоУчету * ВЫБОР
		|		КОГДА НЕ &ТекстЗапросаКоэффициентУпаковки ЕСТЬ NULL 
		|				И &ТекстЗапросаКоэффициентУпаковки <> 0
		|			ТОГДА ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0) / &ТекстЗапросаКоэффициентУпаковки
		|		ИНАЧЕ ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0)
		|	КОНЕЦ КАК СуммаПоУчету,
		|	ТаблицаИнвентаризации.КоличествоФактическое * ВЫБОР
		|		КОГДА НЕ &ТекстЗапросаКоэффициентУпаковки ЕСТЬ NULL 
		|				И &ТекстЗапросаКоэффициентУпаковки <> 0
		|			ТОГДА ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0) / &ТекстЗапросаКоэффициентУпаковки
		|		ИНАЧЕ ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0)
		|	КОНЕЦ КАК СуммаФактическая,
		|	ТаблицаИнвентаризации.Номенклатура.Код КАК ТоварКод,
		|	ТаблицаИнвентаризации.Номенклатура.ЕдиницаИзмерения.Код КАК ЕдиницаИзмеренияКод,
		|	ТаблицаИнвентаризации.Номенклатура.ЕдиницаИзмерения.Наименование КАК ЕдиницаИзмеренияНаименование,
		|	ЛОЖЬ КАК ЭтоВозвратнаяТара
		|ИЗ
		|	ТаблицаИнвентаризации КАК ТаблицаИнвентаризации
		|		ЛЕВОЕ СОЕДИНЕНИЕ ЦеныНоменклатуры КАК ЦеныНоменклатуры
		|		ПО ТаблицаИнвентаризации.Номенклатура = ЦеныНоменклатуры.Номенклатура
		|			И ТаблицаИнвентаризации.Характеристика = ЦеныНоменклатуры.Характеристика
		|
		|УПОРЯДОЧИТЬ ПО
		|	ТоварНаименование,
		|	Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ ПЕРВЫЕ 1
		|	КурсыВалютСрезПоследних.Курс / КурсыВалютСрезПоследних.Кратность КАК КоэффициентПересчета
		|ИЗ
		|	РегистрСведений.КурсыВалют.СрезПоследних(&ДатаОкончания, Валюта = &ВидЦены) КАК КурсыВалютСрезПоследних";

		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,
		"&ТекстЗапросаКоэффициентУпаковки",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаКоэффициентаУпаковки(
		"ЦеныНоменклатуры.Упаковка",
		"ЦеныНоменклатуры.Номенклатура"));
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Номенклатура.Код", "Номенклатура." + КолонкаКодов);

		Запрос.Текст = ТекстЗапроса;

		Результаты = Запрос.ВыполнитьПакет();
		РезультатПоШапке = Результаты[4];
		РезультатПоТабличнойЧасти = Результаты[6];
		РезультатКурсВалюты = Результаты[7];

	КонецЕсли;

	СтруктураВозврата.РезультатПоШапке          = РезультатПоШапке;
	СтруктураВозврата.РезультатПоТабличнойЧасти = РезультатПоТабличнойЧасти;
	СтруктураВозврата.РезультатКурсВалюты       = РезультатКурсВалюты;

	Возврат СтруктураВозврата;

КонецФункции
